{{- if .Values.kamaji.enabled }}
kind: {{ include "capi-proxmox.kubeadmControlPlaneKind" . }}
apiVersion: {{ include "capi-proxmox.kubeadmControlPlaneApiVersion" . }}
metadata:
  name:  {{ include "capi-proxmox.kubeadmControlPlaneName" . }}
  labels:
    kamaji.x-k8s.io/kamaji-name: {{ include "capi-proxmox.name" . | quote }}
    {{- with .Values.kubeadmControlPlane.labels }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
spec:
  dataStoreName: {{ required "kamaki.controlPlane.dataStoreName is required" .Values.kamaji.dataStoreName | quote }}
  {{- with (get .Values.kamaji "addons" | default dict) }}
  addons:
    {{- toYaml . | nindent 4 }}
  {{- end }}
  {{- with (get .Values.kamaji "kubelet" | default dict) }}
  kubelet:
    {{- toYaml . | nindent 4 }}
  {{- end }}
  {{- with (get .Values.kamaji "network" | default dict) }}
  network:
    {{- toYaml . | nindent 4 }}
  {{- end }}
  version: {{ required ".Values.kubeadmControlPlane.version is required" .Values.kubeadmControlPlane.version }}
  replicas: {{ default 1 .Values.kubeadmControlPlane.replicas }}
{{- end }}
